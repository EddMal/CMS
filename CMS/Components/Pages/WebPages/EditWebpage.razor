

@page "/webpages/editwebpage"


@attribute [Authorize]

@using Microsoft.EntityFrameworkCore
@using Microsoft.AspNetCore.Components.QuickGrid
@using CMS.Entities
@using CMS.Data
@using CMS.Components.Pages.ContentPages
@rendermode InteractiveServer
@using BlazorComponents.HtmlTemplates
@namespace CMS.Components.Pages.WebPages
@inject IDbContextFactory<CMS.Data.ApplicationDbContext> DbFactory
@inject IGetCurrentUserService GetCurrentUserService
@implements IAsyncDisposable

<style>
    .containerEditWebPage {
        position: relative;
        padding: 0px;
        border: 0px solid #ccc;
        background-color: #f9f9f9;
    }

    .overlay-btn {
        position: absolute; /* Position relative to the containerEditWebPage */
        top: 50%; /* Position from the top (50% of the parent container) */
        left: 80%; /* Position from the left (50% of the parent container) */
        transform: translate(-50%, -50%); /* Offset the button by half its width and height */
        z-index: 10;
        background-color: rgba(0, 123, 255, 0.2); /* Semi-transparent blue background (50% opacity) */
        color: white;
        border: 2px solid #007bff; /* Blue border */
        padding: 10px 20px;
    }

    .overlay-edit {
        position: absolute; /* Position relative to the containerEditWebPage */
        top: 75%; /* Position from the top (50% of the parent container) */
        left: 50%; /* Position from the left (50% of the parent container) */
        transform: translate(-50%, -50%); /* Offset the button by half its width and height */
        z-index: 10;
        background-color: rgba(0, 123, 255, 0.5); /* Semi-transparent blue background (50% opacity) */
        color: white;
        border: 2px solid #007bff; /* Blue border */
        padding: 10px 20px;
    }

    .overlay-btn:hover {
        background-color: #0056b3;
    }
</style>


<p>
    <a href="@($"/webpages/createmulti?webpageid={WebPageId}")">Skapa flera innehåll</a> |
    <a href="@($"/content/createcontent?webpageid={WebPageId}")">Skapa en innehåll</a> |
    <a href="@($"webpages/editwebpage?webpageid={WebPageId}")">Redigera Sidans information</a>
    @if (StopEditing == false)
    {
        <button type="button" class="btn btn-warning" @onclick="()=> PauseEditContent()"> Pausa redigering </button>
        <button type="button" class="btn btn-warning" @onclick="()=> AddContent()"> Lägg till innehåll </button>

    }
    else
    {
        <button type="button" class="btn btn-warning" @onclick="()=> ResumeEditContent()"> Redigera innehåll </button>

    }
</p>

@if (contents == null) @* || !contents.Any() *@
{
    <p>Denna webbsidan har inget innehåll.</p>
}
else
{
    <QuickGrid Class="table" Items="contents">

            
        <TemplateColumn Context="content">
            @if (StopEditing == false)
            {
                @if (ContentForEditing != content.ContentId)
                {
                    <div class="containerEditWebPage" style="position: relative;">
                        <div class="content">
                            <ContentPreview ContentId="@content.ContentId" />
                        </div>


                        <button class="btn btn-primary overlay-btn btn-primary-outline" @onclick="()=> EditContent(content)"> Redigera </button>
                    </div>
                }
                else
                {
                    <div class="containerEditWebPage" style="position: relative;">
                        <div class="content">
                            <ContentPreview ContentId="@content.ContentId" />
                        </div>
                        <div class="overlay-edit">
                            <CascadingValue Value="content.ContentId">
                                <EditContent />
                            </CascadingValue>
                            <button type="button" class="btn btn-warning" @onclick="()=> ResumeEditContent()"> Klar </button>
                            </div>
                    </div>

                       @*  <CascadingValue Value="content.ContentId">
                            <EditContent />
                        </CascadingValue> *@
                }
            }
            else
            {
                <div class="containerEditWebPage" style="position: relative;">
                    <div class="content">
                        <ContentPreview ContentId="@content.ContentId" />
                    </div>
                </div>
            }
        </TemplateColumn>
    </QuickGrid>
}